# 1장 사용자 수에 따른 규모 확장성

1장에서는 기본적인 지식을 설명하며 설계 방식에 대한 이야기를 진행하는데, 웹 접속 과정이나 DB와 같은 내용은 따로 다루지 않고 넘어가겠다.
## 규모 확장성?
> 규모 확장성은 **시스템의 규모를 얼마나 유연하게 조절**할 수 있는가? 를 나타낸다.

이런 규모는 사용자 수에 비례할텐데 한 명의 사용자부터 몇백만 사용자를 지원하는 시스템에 대한 설계가 우리의 과제일 것이다.

## 수직적 규모 확장 VS 수평적 규모 확장
규모 확장성을 위한 설계는 **수직적인 규모 확장 (sacle up)** 과 **수평적인 규모 확장 (scale out)** 이 존재한다. 둘 다 서버의 트래픽이 높아질 때 성능을 개선시킬 수 있는 방식이다.

### 수직적 규모 확장
서버 자원의 성능을 증가시키는 방식 -> CPU, RAM 등을 추가함
간편하지만, 추가할 수 있는 자원의 한계 존재함
단일 장애 지점에 대한 대비가 되어있지 않음

### 수평적 규모 확장
더 많은 서버를 추가하여 성능을 개선함
단일 장애 지점을 방지할 수 있어, 한 대의 서버가 다운되더라도 전체 시스템에 영향을 미치지 않고 서비스 제공이 가능함

이러한 방식의 차이로 인해, 실제 대규모 환경에서는 수평적 규모 확장법이 더 적절하다.

## 단일 서버
아래 서버 구조는 1개의 웹 서버에 사용자가 바로 연결되어 서비스를 제공받는 형태이다. 만약, 사용자의 수가 늘어 트래픽이 높아지거나 서버가 중단될 경우에 서비스 제공이 느려지거나 아예 제공하지 못하는 상황이 발생하게 된다. 
![단일 서버](https://github.com/BE-Protier/BE-Protier/assets/92606611/faab757f-082e-4671-9d33-10c71ce40004)

### 로드밸런서
이 때, 해당 문제를 해결할 수 있는 방법 중 하나가 **로드밸런싱**이다. 로드밸런서는 로드밸런싱 집합에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할을 한다. 
물론, 로드밸런서를 사용하기 위해서는 단일 서버가 아닌 다중 서버 (n>=2) 로 구성되어야 한다.

![로드밸런서](https://github.com/BE-Protier/BE-Protier/assets/92606611/58ee88ce-c020-4176-8424-cb3570d04f7a)

#### 로드밸런서의 기본 기능
> 1. 헬스체크
> 2. 터널링
> 3. NAT

여기서 볼 기능은 **NAT(Natwork Address Translation)** 이다. 

- DNAT : 외부에서 내부로 트래픽 이동 시, 외부의 공인 IP 주소를 내부의 사설 IP 주소로 변환
- SNAT : 내부에서 외부로 트래픽 이동 시, 내부 사설 IP 주소를 외부의 공인 IP 주소로 변환

위 그림의 흐름은 트래픽 부하가 발생하는 지점의 로드밸런서가 적절하게 트래픽을 분산시켜 내부의 사설 IP 주소로 변환시켜 각 서버로 전달한다.

이를 통해서, 웹 서버의 가용성과 확장성을 향상시킬 수 있게 된다.